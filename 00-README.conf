Configuring OpenSAF
===================
NOTE: Upon installation of OpenSAF(through 'make install' or rpm install),
the $pkgsysconfdir/osafdir.conf (e.g. /etc/opensaf/osafdir.conf) shall contain
definitions of the directory paths where the OpenSAF packages are installed.

OpenSAF configuration files are located in the $pkgsysconfdir (e.g. /etc/opensaf)
directory. 

Following is the brief description of each of the configuration files.

a) nodeinit.conf:
This is the input file to the Node Initialization Daemon for serializing the
opensaf services startup.

NOTE: The interface number and network id arguments to the nid_tipc.sh entry in
nodeinit.conf would get installed with default values. Please change this
accordingly to reflect your correct interface and network-id information. i.e.
please change the highlighted values below for the following entry in
nodeinit.conf :

/usr/lib/opensaf/nid_tipc:TIPC:S:/usr/lib/opensaf/nid_tipc:4000::2:1:start eth2 
1234:stop

In the above line, eth2 refers to the interface information and 1234 refers to
a sample tipc network id. Please change them accordingly. This tipc-network id
should be the same across all system controllers and payloads in that OpenSAF
cluster.

b) slot_id:
The slot_id shall specify a unique value that represents a physical slot
identifier for the node in a chassis environment. The same applies for a
simulation environment on a PC.

c) subslot_id:
The subslot_id shall specify a unique value that represents a physical sub-slot
identifier for the node in a chassis environment. The same applies for a
simulation environment on a PC.

d) chassis_id: 
The chassis_id represents an identifier for the chassis (Distributed Computing
Environment) and should be set to an integer value. The same applies for a
simulation environment on a PC.

e) imm.xml:
This file contains the OpenSAF Information Model. This file is installed
in the $pkgimmxmldir (e.g. /usr/share/opensaf/immxml/ directory).
It contains the classes and configuration objects information of 
all OpenSAF services: IMM, PLM, CLM, AMF, LOG, NTF.

By default based on the configuration options chosen, i.e. whether
a particular service is enabled or not, the imm.xml files of individual OpenSAF 
service are installed in $pkgimmxmldir 
(e.g. /usr/local/share/opensaf/immxml/services) directory.

Perform the following steps to generate the final/combined imm.xml. (Also
refer to the readme in $pkgimmxmldir (e.g. /usr/share/opensaf/immxml/) directory.

% cd $(pkgimmxmldir) 
# To generate a config file (nodes.cfg) for a 5 node cluster, 
do the following commands
% immxml-clustersize -s 2 -p 3

This step shall generate the nodes.cfg file that contains the 
node names for the cluster nodes.

User can edit these node names of choice for generating the final imm.xml.
For eg:- The default values can be replaced with the hostnames of the
cluster nodes.

# generate the imm.xml
% immxml-configure

# copy the generated imm.xml file to the standard OpenSAF configuration directory.
For eg:-
% cp imm.xml.20100217_2201 /etc/opensaf/imm.xml

f) node_name:
The node_name file contains the RDN value of the CLM node name. By default,
the node_name shall contain the hostname (output of the command 'hostname -s').
User can change the default value but the changed value 'must match' with
the value specified in the nodes.cfg that was used to generate the imm.xml.
i.e. the node_name value should match the value present in the generated imm.xml.
 
g) Location of tipc.ko:
The location of the tipc.ko shall be specified through the TIPC_MODULE variable in
the /usr/lib/opensaf/nid_tipc ($pkglibdir/nid_tipc) file.

h) /etc/plmcd.conf
The plmcd.conf file has to be edited as below 'when PLM is enabled'.

The following entries have to be modified accordingly:

[ee_id]
0020f

The ee_id field should contain the DN name of the EE hosting the OpenSAF controller
as specified by the SaPlmEE object.

For eg:-
IF the DN name of the EE object in the imm.xml is set to
...        <object class="SaPlmEE">
...                <dn>safEE=SC-1,safDomain=domain_1</dn>

THEN, the [ee_id] field should be set to 
[ee_id]
safEE=SC-1,safDomain=domain_1

Note: Here SC-1 is the default value specified in the nodes.cfg file while generating
the imm.xml

[controller_1_ip]
10.105.1.3

[controller_2_ip]
10.105.1.6

The controller_1_ip and controller_2_ip fields shall contain the IP Addresses
of the peer controllers.

[os_type]
This is a description of the OS. Currently it needs to follow 
# the following syntax, 1;os;Fedora;2.6.31, where 
# 1 => Version
# os => Product
# Fedora => Vendor
# 2.6.31 => Release
# Note that Version is mandatory while the other fields can be empty

The [os_type] field should match with the values contained
in the imm.xml for that EE.
It shall contain the attribute values of the SaPlmEEBaseType 
and SaPlmEEType objects, each separated by Semi-Colons.

For eg:-
IF The following is the version of the EE in the default imm.xml,
        <object class="SaPlmEEType">
                <dn>safVersion=1,safEEType=Linux_os</dn>

AND, the following is configured in the default imm.xml,

        <object class="SaPlmEEBaseType">
                <dn>safEEType=Linux_os</dn>
                <attr>
                        <name>saPlmEetProduct</name>
                        <value>os</value>
                </attr>
                <attr>
                        <name>saPlmEetVendor</name>
                        <value>SUSE</value>
                </attr>
                <attr>
                        <name>saPlmEetRelease</name>
                        <value>2.6</value>
                </attr>
        </object>

THEN, the [os_type] field shall be set to the following value:
[os_type]
1;os;SUSE;2.6

Using the IMMXML Merge Tool:
===========================
% cd  $pkgimmxmldir (e.g. cd /usr/share/opensaf/immxml/)
% ./immxml-merge $pkgsysconfdir/imm.xml my.xml > merged.xml

(e.g. ./immxml-merge /etc/opensaf/imm.xml my.xml > merged.xml )

Priorities of OpenSAF threads:
==============================
The following list contains the default priority values of OpenSAF threads and the corresponding environment variables could be used to specify them:

Note: The following are default values that are tested and supported by OpenSAF.
A system integrator/designer may choose to fine-tune these values upon their own discretion(and as such are
not for playing around).

Thread Name                	   Environment variable                    Default settings
===========================================================================================
MDS Agent thread                   OSAF_MDS_SCHED_PRIORITY                 85
				   OSAF_MDS_SCHED_POLICY		   2 (SCHED_RR)
Timer thread                       OSAF_TMR_SCHED_PRIORITY                 85
				   OSAF_TMR_SCHED_POLICY		   2 (SCHED_RR)
DTM threads                        OSAF_DTM_INTRANODE_SCHED_PRIORITY       85
				   OSAF_DTM_INTRANODE_SCHED_POLICY	   2 (SCHED_RR) 
                                   OSAF_NODE_DISCOVERY_SCHED_PRIORITY      85				
				   OSAF_NODE_DISCOVERY_SCHED_POLICY	   2 (SCHED_RR) 

RDE Agent thread                   OSAF_RDA_SCHED_PRIORITY                 0				
				   OSAF_RDA_SCHED_POLICY		   0 (SCHED_OTHER) 
MQSV Agent threads		   OSAF_MQA_SCHED_PRIORITY		   0
				   OSAF_MQA_SCHED_POLICY		   0 (SCHED_OTHER) 
				   OSAF_MQA_CLBK_SCHED_PRIORITY		   0
				   OSAF_MQA_CLBK_SCHED_POLICY		   0 (SCHED_OTHER) 
Module Execution thread		   OSAF_EXEC_MOD_SCHED_PRIORITY		   0
				   OSAF_EXEC_MOD_SCHED_POLICY		   0 (SCHED_OTHER) 
AMFND Monitoring thread		   OSAF_AVND_MON_SCHED_PRIORITY		   0
				   OSAF_AVND_MON_SCHED_POLICY		   0 (SCHED_OTHER) 
SMF Campaign thread		   OSAF_SMF_CAMP_SCHED_PRIORITY		   0
				   OSAF_SMF_CAMP_SCHED_POLICY		   0 (SCHED_OTHER) 
SMF Upgrade Procedure thread	   OSAF_SMF_UPGRADE_PROC_SCHED_PRIORITY	   0
				   OSAF_SMF_UPGRADE_PROC_SCHED_POLICY	   0 (SCHED_OTHER) 
SMF Procedure thread	           OSAF_SMF_PROC_SCHED_PRIORITY	           0
				   OSAF_SMF_PROC_SCHED_POLICY	           0 (SCHED_OTHER) 

Priorities of OpenSAF Processes:
================================
The following list contains the default priority values of OpenSAF processes and the corresponding environment variables could be used to specify them:

Process Name                	   Environment variable                    Default settings		
===========================================================================================
AMF Node Director process          OSAFAMFND_SCHED_PRIORITY                1
				   OSAFAMFND_SCHED_POLICY		   2 (SCHED_RR) 
AMF WatchDog process               OSAFAMFWDOG_SCHED_PRIORITY              1
				   OSAFAMFWDOG_SCHED_POLICY		   2 (SCHED_RR) 
AMF Director process               OSAFAMFD_SCHED_PRIORITY                 0
				   OSAFAMFD_SCHED_POLICY		   0 (SCHED_OTHER) 
RDE Director process		   OSAFRDED_SCHED_PRIORITY		   0
				   OSAFRDED_SCHED_POLICY		   0 (SCHED_OTHER) 
FM Director process		   OSAFFMD_SCHED_PRIORITY		   0
				   OSAFFMD_SCHED_POLICY			   0 (SCHED_OTHER)  
IMM Director process		   OSAFIMMD_SCHED_PRIORITY		   0
				   OSAFIMMD_SCHED_POLICY		   0 (SCHED_OTHER)  
IMM Node Director process	   OSAFIMMND_SCHED_PRIORITY		   0
				   OSAFIMMND_SCHED_POLICY		   0 (SCHED_OTHER)  
LOG Director process		   OSAFLOGD_SCHED_PRIORITY		   0
				   OSAFLOGD_SCHED_POLICY		   0 (SCHED_OTHER)  
NTF Director process		   OSAFNTFD_SCHED_PRIORITY		   0
				   OSAFNTFD_SCHED_POLICY		   0 (SCHED_OTHER)  
CLM Director process		   OSAFCLMD_SCHED_PRIORITY		   0
				   OSAFCLMD_SCHED_POLICY		   0 (SCHED_OTHER)  
SMF Director process		   OSAFSMFD_SCHED_PRIORITY		   0
				   OSAFSMFD_SCHED_POLICY		   0 (SCHED_OTHER)  
SMF Node Director process	   OSAFSMFND_SCHED_PRIORITY		   0
				   OSAFSMFND_SCHED_POLICY		   0 (SCHED_OTHER)  
MQSv Director process		   OSAFMSGD_SCHED_PRIORITY		   0
				   OSAFMSGD_SCHED_POLICY		   0 (SCHED_OTHER)  
MQSv Node Director process 	   OSAFMSGND_SCHED_PRIORITY		   0
				   OSAFMSGND_SCHED_POLICY		   0 (SCHED_OTHER)  
LCK  Director process	           OSAFLCKD_SCHED_PRIORITY		   0
				   OSAFLCKD_SCHED_POLICY		   0 (SCHED_OTHER)  
LCK  Node Director process	   OSAFLCKND_SCHED_PRIORITY		   0
				   OSAFLCKND_SCHED_POLICY		   0 (SCHED_OTHER)  
CKPT Director process	   	   OSAFCKPTD_SCHED_PRIORITY		   0
				   OSAFCKPTD_SCHED_POLICY		   0 (SCHED_OTHER)  
CKPT Node Director process	   OSAFCKPTND_SCHED_PRIORITY		   0
				   OSAFCKPTND_SCHED_POLICY		   0 (SCHED_OTHER)  
EDS  Director process	           OSAFEVTD_SCHED_PRIORITY		   0
				   OSAFEVTD_SCHED_POLICY		   0 (SCHED_OTHER)  


